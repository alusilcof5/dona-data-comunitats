<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Analític</title>
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/chatbot.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #667eea;
            --ligth: #f8fafc;
            --secondary: #2e005c;
        }

        .nav-link.active {
            background: var(--ligth);
            color: var(--primary);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card {
            background: var(--ligth);
            color: var(--primary);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 2rem 0;
        }

        .filter-section {
            background: linear-gradient(135deg, #2d0f53 0%, #a157f5 100%);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hero-gradient {
            background: linear-gradient(90deg, #667eea, #baa6ce);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .navbar {
            position: sticky;
            top: 0;
            z-index: 999;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            transition: background 0.3s ease;
            /* Transición suave para el fondo */
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-img {
            height: 120px;
            width: auto;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 2rem;
        }

        .nav-menu a {
            font-size: 1.1rem;
            /* Tamaño de fuente más legible */
            text-decoration: none;
            color: var(--pcolor);
            font-weight: 600;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .nav-menu a:hover {
            background: var(--ligth);
        }
    </style>
</head>

<body class="bg-gray-50 font-sans">
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">
                <img src="../assets/images/logo-dona.png" alt="Logo" class="logo-img">
            </a>
            <ul class="nav-menu">
                <li><a href="./directory.html" class="nav-link">Directori</a></li>
                <li><a href="./info.html" class="nav-link">Informació</a></li>
                <li><a href="./vista/dashboard.html" class="nav-link">Estudi</a></li>
            </ul>
        </div>
    </nav>

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 text-lg">Carregant dades de l'enquesta...</p>
        </div>
    </div>

    <!-- Error Screen -->
    <div id="error" class="fixed inset-0 bg-red-50 flex items-center justify-center z-50" style="display: none;">
        <div class="text-center p-8">
            <div class="text-red-500 text-6xl mb-4">⚠️</div>
            <h2 class="text-2xl font-bold text-red-700 mb-2">Error en carregar les dades</h2>
            <p id="error-message" class="text-red-600">No s'ha pogut accedir a l'arxiu 'output.json'. Verifiqueu que
                estigui
                a la mateixa carpeta que aquest arxiu.</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" style="display: none;">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-2xl font-bold text-gray-800"></div>
                    </div>
                    <div class="hidden md:flex space-x-1">
                        <button class="nav-link px-4 py-2 rounded-lg text-sm font-medium transition-colors active"
                            onclick="showSection('intro')">Introducció</button>
                        <button class="nav-link px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            onclick="showSection('demographics')">Perfil Sociodemogràfic</button>
                        <button class="nav-link px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            onclick="showSection('participation')">Participació</button>
                        <button class="nav-link px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            onclick="showSection('inclusion')">Inclusió</button>
                        <button class="nav-link px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            onclick="showSection('impact')">Impacte</button>
                        <button class="nav-link px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                            onclick="showSection('barriers')">Barreres</button>

                    </div>
                    <div class="md:hidden">
                        <button id="mobile-menu-btn" class="text-gray-600 hover:text-gray-800">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden bg-white shadow-lg" style="display: none;">
            <div class="px-4 py-2 space-y-1">
                <button class="block w-full text-left px-4 py-2 rounded-lg text-sm font-medium"
                    onclick="showSection('intro'); toggleMobileMenu()">Introducció</button>
                <button class="block w-full text-left px-4 py-2 rounded-lg text-sm font-medium"
                    onclick="showSection('demographics'); toggleMobileMenu()">Perfil Sociodemogràfic</button>
                <button class="block w-full text-left px-4 py-2 rounded-lg text-sm font-medium"
                    onclick="showSection('participation'); toggleMobileMenu()">Participació</button>
                <button class="block w-full text-left px-4 py-2 rounded-lg text-sm font-medium"
                    onclick="showSection('inclusion'); toggleMobileMenu()">Inclusió</button>
                <button class="block w-full text-left px-4 py-2 rounded-lg text-sm font-medium"
                    onclick="showSection('impact'); toggleMobileMenu()">Impacte</button>
                <button class="block w-full text-left px-4 py-2 rounded-lg text-sm font-medium"
                    onclick="showSection('barriers'); toggleMobileMenu()">Barreres</button>
                <button class="block w-full text-left px-4 py-2 rounded-lg text-sm font-medium"
                    onclick="showSection('data'); toggleMobileMenu()">Dades</button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="bg-white border-b" style="color: var(--primary)">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div id="stats-container" class="grid grid-cols-2 md:grid-cols-5 gap-4" style="color: var(--primary)">
                    <!-- Stats will be populated here -->
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-section">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex flex-wrap gap-4 items-center justify-center">
                    <div class="flex items-center space-x-2">
                        <label class="text-white font-medium text-sm">Sector:</label>
                        <select id="sector-filter" class="px-3 py-1 rounded-lg border-0 text-sm">
                            <option value="">Tots</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-white font-medium text-sm">Experiència:</label>
                        <select id="experience-filter" class="px-3 py-1 rounded-lg border-0 text-sm">
                            <option value="">Totes</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-white font-medium text-sm">Participació:</label>
                        <select id="participation-filter" class="px-3 py-1 rounded-lg border-0 text-sm">
                            <option value="">Totes</option>
                        </select>
                    </div>
                    <button onclick="clearFilters()"
                        class="bg-white text-pink-600 px-4 py-1 rounded-lg text-sm font-medium hover:bg-gray-100 transition-colors">
                        Netejar Filtres
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- Introduction Section -->
            <section id="intro" class="section active">
                <div class="hero-gradient text-white rounded-2xl p-8 mb-8">
                    <div class="max-w-4xl mx-auto text-center">
                        <h1 class="text-4xl md:text-5xl font-bold mb-6">Anàlisi de l'impacte de les comunitats a
                            Barcelona</h1>
                        <div class="grid md:grid-cols-3 gap-6 text-center mb-[20px]">
                            <div class="bg-white/10 rounded-xl p-6">
                                <div class="flex justify-center items-center mb-2">
                                    <img src="./dashboard/images/2.png" alt="icona" width="50" height="50">
                                </div>
                                <h3 class="font-semibold mb-2">Objectiu</h3>
                                <p class="text-sm opacity-80">Avaluar l’impacte de les comunitats de dones en tecnologia
                                    a Barcelona</p>
                            </div>
                            <div class="bg-white/10 rounded-xl p-6">
                                <div class="flex justify-center items-center mb-2">
                                    <img src="./dashboard/images/1.png" alt="icona" width="40" height="40">
                                </div>
                                <h3 class="font-semibold mb-2">Metodologia</h3>
                                <p class="text-sm opacity-80">Enquesta dirigida a professionals del sector tecnològic
                                </p>
                            </div>

                            <div class="bg-white/10 rounded-xl p-6">
                                <div class="flex justify-center items-center mb-2">
                                    <img src="./dashboard/images/3.png" alt="icona ODS" width="40" height="40">
                                </div>
                                <h3 class="font-semibold mb-2">ODS</h3>
                                <p class="text-sm opacity-80">Contribució als Objectius de Desenvolupament Sostenible
                                </p>
                            </div>

                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-xl p-6 shadow-lg card-hover">
                            <div class="text-6xl text-center mb-4"><img src="./dashboard/images/10.png" alt=""
                                    width="140" height="140"></div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Context de l'Estudi</h2>
                            <p class="text-gray-600 mb-6">
                                Aquest dashboard presenta els resultats d'una enquesta realitzada a professionals del
                                sector tecnològic a Barcelona,
                                amb l'objectiu d'analitzar l'impacte de les comunitats de dones en tecnologia.
                            </p>
                            <p class="text-gray-600">
                                Les dades recopilades ens permeten entendre millor com aquestes iniciatives
                                contribueixen a la inclusió,
                                el desenvolupament professional i la superació de barreres en el sector tecnològic.
                            </p>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-lg card-hover">
                            <div class="text-6xl text-center mb-4"><img src="./dashboard/images/4.png" alt=""
                                    width="140" height="140"></div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Àrees d'Anàlisi</h2>
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-center"><span
                                        class="w-2 h-2 bg-blue-500 rounded-full mr-3"></span>Perfil sociodemogràfic de
                                    les participants</li>
                                <li class="flex items-center"><span
                                        class="w-2 h-2 bg-green-500 rounded-full mr-3"></span>Nivells de participació en
                                    comunitats</li>
                                <li class="flex items-center"><span
                                        class="w-2 h-2 bg-purple-500 rounded-full mr-3"></span>Impacte en la inclusió
                                    tecnològica</li>
                                <li class="flex items-center"><span
                                        class="w-2 h-2 bg-pink-500 rounded-full mr-3"></span>Barreres superades i
                                    beneficis obtinguts</li>
                                <li class="flex items-center"><span
                                        class="w-2 h-2 bg-orange-500 rounded-full mr-3"></span>Contribució als ODS</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Demographics Section -->
            <section id="demographics" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-4xl mr-3"><img src="./dashboard/images/11.png" alt="" width="80"
                                height="80"></span>
                        Perfil Sociodemogràfic
                    </h2>
                    <p class="text-gray-600">Característiques demogràfiques i professionals de les participants</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Distribució per Edat</h3>
                        <div class="chart-container">
                            <canvas id="age-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Nivell Educatiu</h3>
                        <div class="chart-container">
                            <canvas id="education-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Experiència en Tecnologia</h3>
                        <div class="chart-container">
                            <canvas id="experience-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Sector d'Organització</h3>
                        <div class="chart-container">
                            <canvas id="sector-chart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Participation Section -->
            <section id="participation" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-4xl mr-3"><img src="./dashboard/images/5.png" alt="" width="80"
                                height="80"></span>
                        Participació en Comunitats
                    </h2>
                    <p class="text-gray-600">Anàlisi de la participació activa en comunitats tecnològiques</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Freqüència de Participació</h3>
                        <div class="chart-container">
                            <canvas id="participation-frequency-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Rols Tècnics de Lideratge</h3>
                        <div class="chart-container">
                            <canvas id="roles-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Estructura Organitzativa de Comunitats</h3>
                        <div class="chart-container">
                            <canvas id="structure-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Forma Principal de Participació</h3>
                        <div class="chart-container">
                            <canvas id="participation-form-chart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Inclusion Section -->
            <section id="inclusion" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-4xl mr-3"><img src="./dashboard/images/6.png" alt="" width="80"
                                height="80"></span>
                        Inclusió en Entorns Tecnològics
                    </h2>
                    <p class="text-gray-600">Avaluació de l'impacte en la inclusió i pertinença</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Contribució a la Inclusió</h3>
                        <div class="chart-container">
                            <canvas id="inclusion-impact-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Augment de Dones en Equips Tech</h3>
                        <div class="chart-container">
                            <canvas id="women-increase-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Pertinença Activa en Comunitats</h3>
                        <div class="chart-container">
                            <canvas id="active-membership-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Estructura Col·laborativa i Equitat</h3>
                        <div class="chart-container">
                            <canvas id="collaborative-equity-chart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Impact Section -->
            <section id="impact" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-4xl mr-3"><img src="./dashboard/images/7.png" alt="" width="80"
                                height="80"></span>
                        Impacte d'Iniciatives
                    </h2>
                    <p class="text-gray-600">Anàlisi de l'impacte de les iniciatives comunitat-empresa</p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Activitats Efectives per a l'Equitat</h3>
                        <div class="chart-container">
                            <canvas id="equity-activities-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Contribució a ODS 5</h3>
                        <div class="chart-container">
                            <canvas id="ods-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Expansió de Xarxa Professional</h3>
                        <div class="chart-container">
                            <canvas id="network-expansion-chart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4">Accés a Oportunitats Laborals</h3>
                        <div class="chart-container">
                            <canvas id="job-opportunities-chart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Barriers Section -->
            <section id="barriers" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-4xl mr-3">🚧</span>
                        Barreres Superades
                    </h2>
                    <p class="text-gray-600">Anàlisi de les barreres que les comunitats han ajudat a superar</p>
                </div>

                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Principals Barreres Superades</h3>
                    <div class="chart-container">
                        <canvas id="barriers-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Data Section 
            <section id="data" class="section">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-4xl mr-3"></span>
                        Dades Detallades
                    </h2>
                    <p class="text-gray-600">Exploració detallada de les respostes individuals</p>
                </div>

                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="mb-4 flex justify-between items-center">
                        <h3 class="text-xl font-semibold">Taula de Respostes</h3>
                        <input type="text" id="search-input" placeholder="Cercar..."
                            class="px-4 py-2 border rounded-lg">
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-2 text-left">Edat</th>
                                    <th class="px-4 py-2 text-left">Nacionalitat</th>
                                    <th class="px-4 py-2 text-left">Educació</th>
                                    <th class="px-4 py-2 text-left">Experiència</th>
                                    <th class="px-4 py-2 text-left">Sector</th>
                                    <th class="px-4 py-2 text-left">Participació</th>
                                </tr>
                            </thead>
                            <tbody id="data-table-body">
                                Data will be populated here 
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>-->

            <!-- Footer -->
            <footer class="bg-gray-800 text-white py-8 mt-16">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="grid md:grid-cols-3 gap-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Agraïments</h3>
                            <p class="text-gray-300 text-sm">
                                Gràcies a totes les professionals que van participar en aquesta enquesta,
                                contribuint amb les seves experiències i perspectives.
                            </p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Sobre el Projecte</h3>
                            <p class="text-gray-300 text-sm">
                                Aquest dashboard forma part d'un treball acadèmic que analitza
                                l'impacte de les comunitats de dones en tecnologia.
                            </p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Contacte</h3>
                            <p class="text-gray-300 text-sm">
                                Per a més informació sobre aquest estudi o per a col·laboracions futures,
                                no dubteu a contactar-nos.
                            </p>
                        </div>
                    </div>
                    <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400 text-sm">
                        <p>&copy; 2025. Tots els drets reservats.</p>
                    </div>
                </div>
                <div class="footer-container">
                    <div class="footer-content">
                        <div class="footer-left">
                        </div>
                        <div class="footer-right">
                            <div class="social-links">
                                <a href="https://www.linkedin.com/in/ana-lucia-silva-cordoba/">
                                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                                    <span class="sr-only">LinkedIn</span>
                                </a>
                                <a href="https://github.com/alusilcof5"><i class="fab fa-github fa-2x"
                                        aria-hidden="true"></i><span class="sr-only">GitHub</span></a>
                            </div>

                        </div>
                    </div>
                    <div class="footer-bottom">
                        <p>&copy; 2025 Ana Lucía Silva Córdoba — Projecte Final de Màster. Tots els dret reservats.</p>
                    </div>
                </div>
            </footer>

    </div>

    <script>
        // Global variables
        let allData = [];
        let filteredData = [];
        let charts = {};

        // Utility functions
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.style.display = mobileMenu.style.display === 'none' ? 'block' : 'none';
        }

        // Data transformation function based on new headers
        function transformDataItem(item) {
            return {
                // Información básica
                timestamp: item.Timestamp,
                age: parseInt(item.Edad) || 0,
                nationality: item.Nacionalidad,
                education_level: item.Nivel_Educativo,
                tech_experience_years: item.Años_Experiencia_Tech,
                city: item.Ciudad_Residencia,
                employment_status: item.Situacion_Laboral,
                salary_range: item.Salario_Anual_Aproximado,
                has_dependents: parseBoolean(item.Personas_a_Cargo),

                // Información de organización
                organization_type: item.Tipo_Organizacion,
                organization_sector: item.Sector_Organizacion,

                // Participación en comunidad
                community_participation_frequency: item.Frecuencia_Participacion_Comunidad,
                community_inclusion_impact: item.Contribucion_Inclusion_Comunidad,
                main_participation_form: item.Forma_Principal_Participacion,
                community_name: item.Nombre_Comunidad,
                community_structure: item.Estructura_Organizativa_Comunidad,
                collaborative_structure_equity: item.Estructura_Colaborativa_Equidad,
                event_frequency: item.Frecuencia_Eventos_Comunidad,

                // Roles y liderazgo
                tech_leadership_roles: parseArrayField(item.Rol_Tech_Liderazgo),

                // Impacto y beneficios
                networking_expansion: item.Expansion_Red_Profesional,
                job_opportunities_access: parseBoolean(item.Acceso_Oportunidades_Laborales),
                job_opportunity_type: item.Tipo_Oportunidades_Laborales,
                community_influence_staying: item.Influencia_Comunidad_Continuidad_Sector,
                how_community_encouraged: item.Como_Comunidad_Animo_Quedarse,

                // Información booleana
                resides_in_barcelona: parseBoolean(item.Residencia_Barcelona),
                identifies_as_woman: parseBoolean(item.Identidad_Mujer),
                works_in_tech_3_years: parseBoolean(item.Trabajo_Sector_Tech_3Años),
                is_community_member: parseBoolean(item.Miembro_Comunidad_Tech_Mujeres),
                increased_women_in_teams: item.Aumento_Mujeres_Equipos_Tech,
                participated_company_initiatives: parseBoolean(item.Participacion_Iniciativas_Empresas),
                company_initiatives_help_inclusion: item.Iniciativas_Empresas_Inclusion_Laboral,

                // Arrays parseados
                effective_equity_activities: parseArrayField(item.Actividades_Efectivas_Equidad),
                barriers_helped_with: parseArrayField(item.Barreras_Superadas_Comunidad),

                // Campos de texto
                future_inclusion_actions: item.Acciones_Futuras_Inclusion,
                future_inclusion_actions_2: item.Acciones_Futuras_Inclusión,

                // ODS contribution
                ods_contribution: item.Contribucion_ODS5_Igualdad_Genero
            };
        }

        function parseArrayField(field) {
            if (!field || field === "" || field === "N/A") return [];
            // Separar por comas y limpiar espacios
            return field.split(/[,\/]/).map(item => item.trim()).filter(item => item !== "" && item !== "N/A");
        }

        function parseBoolean(field) {
            if (!field) return false;
            const lowerField = field.toLowerCase();
            return lowerField.includes('sí') || lowerField.includes('yes') || lowerField === 'true';
        }

        // Load and process data
        async function loadData() {
            try {
                const response = await fetch('../model/output.json');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const rawData = await response.json();
                allData = rawData.map(item => transformDataItem(item));
                filteredData = [...allData];

                console.log('Dades carregades:', allData.length, 'registres');
                console.log('Mostra de dades transformades:', allData[0]);

                hideLoading();
                showApp();
                generateStats();
                generateAllCharts();
                populateFilters();
                generateDataTable();

            } catch (error) {
                console.error('Error carregant dades:', error);
                showError();
            }
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError() {
            document.getElementById('error').style.display = 'flex';
            document.getElementById('loading').style.display = 'none';
        }

        function showApp() {
            document.getElementById('app').style.display = 'block';
        }

        function generateStats() {
            const validResponses = filteredData.length;
            const avgAge = validResponses > 0 ?
                Math.round(filteredData.reduce((sum, item) => sum + (item.age || 0), 0) / validResponses) : 0;
            const barcelonaResidents = filteredData.filter(item => item.resides_in_barcelona === true).length;
            const activeMembers = filteredData.filter(item => item.is_community_member === true).length;
            const positiveImpact = filteredData.filter(item =>
                item.community_inclusion_impact && (
                    item.community_inclusion_impact.includes("Sí") ||
                    item.community_inclusion_impact.includes("Yes") ||
                    item.community_inclusion_impact.includes("parte")
                )
            ).length;

            const statsContainer = document.getElementById('stats-container');
            statsContainer.innerHTML = `
                <div class="stat-card p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold">${validResponses}</div>
                    <div class="text-sm opacity-90">Respostes Vàlides</div>
                </div>
                <div class="stat-card p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold">${avgAge}</div>
                    <div class="text-sm opacity-90">Edat Mitjana</div>
                </div>
                <div class="stat-card p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold">${Math.round((barcelonaResidents / validResponses) * 100)}%</div>
                    <div class="text-sm opacity-90">Resideixen a Barcelona</div>
                </div>
                <div class="stat-card p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold">${Math.round((activeMembers / validResponses) * 100)}%</div>
                    <div class="text-sm opacity-90">Membres Actius</div>
                </div>
                <div class="stat-card p-6 rounded-xl text-center">
                    <div class="text-3xl font-bold">${Math.round((positiveImpact / validResponses) * 100)}%</div>
                    <div class="text-sm opacity-90">Amb Impacte Positiu</div>
                </div>
            `;
        }

        function generateAllCharts() {
            generateAgeChart();
            generateEducationChart();
            generateExperienceChart();
            generateSectorChart();
            generateParticipationFrequencyChart();
            generateRolesChart();
            generateStructureChart();
            generateParticipationFormChart();
            generateInclusionImpactChart();
            generateWomenIncreaseChart();
            generateActiveMembershipChart();
            generateCollaborativeEquityChart();
            generateEquityActivitiesChart();
            generateODSChart();
            generateNetworkExpansionChart();
            generateJobOpportunitiesChart();
            generateBarriersChart();
        }

        function generateAgeChart() {
            const ageGroups = {};
            filteredData.forEach(item => {
                if (item.age && item.age > 0) {
                    const ageGroup = Math.floor(item.age / 5) * 5;
                    const label = `${ageGroup}-${ageGroup + 4}`;
                    ageGroups[label] = (ageGroups[label] || 0) + 1;
                }
            });
            createChart('age-chart', 'bar', ageGroups, 'Distribució per Edat');
        }

        function generateEducationChart() {
            const education = {};
            filteredData.forEach(item => {
                if (item.education_level) {
                    education[item.education_level] = (education[item.education_level] || 0) + 1;
                }
            });
            createChart('education-chart', 'doughnut', education, 'Nivell Educatiu');
        }

        function generateExperienceChart() {
            const experience = {};
            filteredData.forEach(item => {
                if (item.tech_experience_years) {
                    experience[item.tech_experience_years] = (experience[item.tech_experience_years] || 0) + 1;
                }
            });
            createChart('experience-chart', 'bar', experience, 'Anys d\'Experiència');
        }

        function generateSectorChart() {
            const sectors = {};
            filteredData.forEach(item => {
                if (item.organization_sector) {
                    sectors[item.organization_sector] = (sectors[item.organization_sector] || 0) + 1;
                }
            });
            createChart('sector-chart', 'pie', sectors, 'Sector d\'Organització');
        }

        function generateParticipationFrequencyChart() {
            const participation = {};
            filteredData.forEach(item => {
                if (item.community_participation_frequency) {
                    // Limpiar el texto de la frecuencia
                    let cleanFreq = item.community_participation_frequency.split('/')[0].trim();
                    participation[cleanFreq] = (participation[cleanFreq] || 0) + 1;
                }
            });
            createChart('participation-frequency-chart', 'doughnut', participation, 'Freqüència de Participació');
        }

        function generateRolesChart() {
            const roles = {};
            filteredData.forEach(item => {
                if (item.tech_leadership_roles && Array.isArray(item.tech_leadership_roles)) {
                    item.tech_leadership_roles.forEach(role => {
                        if (role && role.trim() !== '') {
                            roles[role] = (roles[role] || 0) + 1;
                        }
                    });
                }
            });
            createChart('roles-chart', 'horizontalBar', roles, 'Rols Tècnics de Lideratge');
        }

        function generateStructureChart() {
            const structures = {};
            filteredData.forEach(item => {
                if (item.community_structure) {
                    let cleanStructure = item.community_structure.split('(')[0].trim();
                    structures[cleanStructure] = (structures[cleanStructure] || 0) + 1;
                }
            });
            createChart('structure-chart', 'pie', structures, 'Estructura Organitzativa');
        }

        function generateParticipationFormChart() {
            const forms = {};
            filteredData.forEach(item => {
                if (item.main_participation_form) {
                    forms[item.main_participation_form] = (forms[item.main_participation_form] || 0) + 1;
                }
            });
            createChart('participation-form-chart', 'doughnut', forms, 'Forma Principal de Participació');
        }

        function generateInclusionImpactChart() {
            const impact = {};
            filteredData.forEach(item => {
                if (item.community_inclusion_impact) {
                    let cleanImpact = item.community_inclusion_impact.split('/')[0].trim();
                    impact[cleanImpact] = (impact[cleanImpact] || 0) + 1;
                }
            });
            createChart('inclusion-impact-chart', 'pie', impact, 'Contribució a la Inclusió');
        }

        function generateWomenIncreaseChart() {
            const increase = {};
            filteredData.forEach(item => {
                if (item.increased_women_in_teams) {
                    let cleanIncrease = item.increased_women_in_teams.split('/')[0].trim();
                    increase[cleanIncrease] = (increase[cleanIncrease] || 0) + 1;
                }
            });
            createChart('women-increase-chart', 'doughnut', increase, 'Augment de Dones en Equips');
        }

        function generateActiveMembershipChart() {
            const membership = {};
            filteredData.forEach(item => {
                const status = item.is_community_member ? "Membre actiu" : "No és membre actiu";
                membership[status] = (membership[status] || 0) + 1;
            });
            createChart('active-membership-chart', 'pie', membership, 'Pertinença Activa');
        }

        function generateCollaborativeEquityChart() {
            const equity = {};
            filteredData.forEach(item => {
                if (item.collaborative_structure_equity) {
                    let cleanEquity = item.collaborative_structure_equity.split('/')[0].trim();
                    equity[cleanEquity] = (equity[cleanEquity] || 0) + 1;
                }
            });
            createChart('collaborative-equity-chart', 'doughnut', equity, 'Estructura Col·laborativa i Equitat');
        }

        function generateEquityActivitiesChart() {
            const activities = {};
            filteredData.forEach(item => {
                if (item.effective_equity_activities && Array.isArray(item.effective_equity_activities)) {
                    item.effective_equity_activities.forEach(activity => {
                        if (activity && activity.trim() !== '') {
                            // Limpiar el texto de la actividad
                            let cleanActivity = activity.split('/')[0].trim();
                            activities[cleanActivity] = (activities[cleanActivity] || 0) + 1;
                        }
                    });
                }
            });
            createChart('equity-activities-chart', 'horizontalBar', activities, 'Activitats Efectives per a l\'Equitat');
        }

        function generateODSChart() {
            const ods = {};
            filteredData.forEach(item => {
                if (item.ods_contribution) {
                    let cleanODS = item.ods_contribution.split('/')[0].trim();
                    ods[cleanODS] = (ods[cleanODS] || 0) + 1;
                }
            });
            createChart('ods-chart', 'bar', ods, 'Contribució a ODS 5');
        }

        function generateNetworkExpansionChart() {
            const expansion = {};
            filteredData.forEach(item => {
                if (item.networking_expansion) {
                    let cleanExpansion = item.networking_expansion.split('/')[0].trim();
                    expansion[cleanExpansion] = (expansion[cleanExpansion] || 0) + 1;
                }
            });
            createChart('network-expansion-chart', 'doughnut', expansion, 'Expansió de Xarxa Professional');
        }

        function generateJobOpportunitiesChart() {
            const opportunities = {};
            filteredData.forEach(item => {
                const hasOpportunities = item.job_opportunities_access ? "Sí" : "No";
                opportunities[hasOpportunities] = (opportunities[hasOpportunities] || 0) + 1;
            });
            createChart('job-opportunities-chart', 'pie', opportunities, 'Accés a Oportunitats Laborals');
        }

        function generateBarriersChart() {
            const barriers = {};
            filteredData.forEach(item => {
                if (item.barriers_helped_with && Array.isArray(item.barriers_helped_with)) {
                    item.barriers_helped_with.forEach(barrier => {
                        if (barrier && barrier.trim() !== '') {
                            let cleanBarrier = barrier.split('/')[0].trim();
                            barriers[cleanBarrier] = (barriers[cleanBarrier] || 0) + 1;
                        }
                    });
                }
            });
            createChart('barriers-chart', 'horizontalBar', barriers, 'Barreres Superades');
        }

        function createChart(canvasId, type, data, title) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) {
                console.warn(`Canvas amb id ${canvasId} no trobat`);
                return;
            }

            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            const filteredData = Object.entries(data).filter(([key, value]) => key && key.trim() !== '' && value > 0);

            if (filteredData.length === 0) {
                console.warn(`No hi ha dades disponibles per al gràfic ${canvasId}`);
                return;
            }

            const sortedData = filteredData.sort(([, a], [, b]) => b - a);
            const labels = sortedData.map(([label]) => label);
            const values = sortedData.map(([, value]) => value);

            const colors = [
                '#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe',
                '#00f2fe', '#43e97b', '#38f9d7', '#ffecd2', '#fcb69f',
                '#a8edea', '#fed6e3', '#d299c2', '#fef9d7', '#c471ed',
                '#ff9a9e', '#fecfef', '#fecfef', '#667eea', '#764ba2'
            ];

            const config = {
                type: type === 'horizontalBar' ? 'bar' : type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: title,
                        data: values,
                        backgroundColor: type === 'pie' || type === 'doughnut' ?
                            colors.slice(0, labels.length) : colors[0],
                        borderColor: type === 'pie' || type === 'doughnut' ?
                            colors.slice(0, labels.length) : colors[1],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: type === 'horizontalBar' ? 'y' : 'x',
                    plugins: {
                        legend: {
                            display: type === 'pie' || type === 'doughnut',
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const value = context.parsed.y || context.parsed;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: type === 'pie' || type === 'doughnut' ? {} : {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                maxRotation: 45,
                                minRotation: 0
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            try {
                charts[canvasId] = new Chart(ctx, config);
            } catch (error) {
                console.error(`Error creant gràfic ${canvasId}:`, error);
            }
        }

        function populateFilters() {
            const sectorFilter = document.getElementById('sector-filter');
            const experienceFilter = document.getElementById('experience-filter');
            const participationFilter = document.getElementById('participation-filter');

            if (!sectorFilter || !experienceFilter || !participationFilter) {
                console.warn('Elements de filtre no trobats');
                return;
            }

            const sectors = new Set();
            const experiences = new Set();
            const participations = new Set();

            allData.forEach(item => {
                if (item.organization_sector) sectors.add(item.organization_sector);
                if (item.tech_experience_years) experiences.add(item.tech_experience_years);
                if (item.community_participation_frequency) {
                    let cleanFreq = item.community_participation_frequency.split('/')[0].trim();
                    participations.add(cleanFreq);
                }
            });

            sectorFilter.innerHTML = '<option value="">Tots</option>';
            experienceFilter.innerHTML = '<option value="">Totes</option>';
            participationFilter.innerHTML = '<option value="">Totes</option>';

            [...sectors].sort().forEach(sector => {
                const option = document.createElement('option');
                option.value = sector;
                option.textContent = sector;
                sectorFilter.appendChild(option);
            });

            [...experiences].sort().forEach(exp => {
                const option = document.createElement('option');
                option.value = exp;
                option.textContent = exp;
                experienceFilter.appendChild(option);
            });

            [...participations].sort().forEach(part => {
                const option = document.createElement('option');
                option.value = part;
                option.textContent = part;
                participationFilter.appendChild(option);
            });

            sectorFilter.addEventListener('change', applyFilters);
            experienceFilter.addEventListener('change', applyFilters);
            participationFilter.addEventListener('change', applyFilters);
        }

        function applyFilters() {
            const selectedSector = document.getElementById('sector-filter')?.value;
            const selectedExperience = document.getElementById('experience-filter')?.value;
            const selectedParticipation = document.getElementById('participation-filter')?.value;

            filteredData = allData.filter(item => {
                const matchesSector = !selectedSector || item.organization_sector === selectedSector;
                const matchesExperience = !selectedExperience || item.tech_experience_years === selectedExperience;
                const matchesParticipation = !selectedParticipation ||
                    (item.community_participation_frequency && item.community_participation_frequency.includes(selectedParticipation));
                return matchesSector && matchesExperience && matchesParticipation;
            });

            generateStats();
            generateAllCharts();
            generateDataTable();
        }

        function clearFilters() {
            const sectorFilter = document.getElementById('sector-filter');
            const experienceFilter = document.getElementById('experience-filter');
            const participationFilter = document.getElementById('participation-filter');

            if (sectorFilter) sectorFilter.value = '';
            if (experienceFilter) experienceFilter.value = '';
            if (participationFilter) participationFilter.value = '';

            filteredData = [...allData];
            generateStats();
            generateAllCharts();
            generateDataTable();
        }

        function generateDataTable() {
            const tableBody = document.getElementById('data-table-body');
            if (!tableBody) {
                console.warn('Element del cos de la taula no trobat');
                return;
            }

            tableBody.innerHTML = '';
            const displayLimit = 100;
            const dataToDisplay = filteredData.slice(0, displayLimit);

            dataToDisplay.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-2">${item.age || 'N/A'}</td>
                    <td class="px-4 py-2">${item.nationality || 'N/A'}</td>
                    <td class="px-4 py-2">${item.education_level || 'N/A'}</td>
                    <td class="px-4 py-2">${item.tech_experience_years || 'N/A'}</td>
                    <td class="px-4 py-2">${item.organization_sector || 'N/A'}</td>
                    <td class="px-4 py-2">${item.community_participation_frequency ? item.community_participation_frequency.split('/')[0].trim() : 'N/A'}</td>
                `;
                tableBody.appendChild(row);
            });

            if (filteredData.length > displayLimit) {
                const infoRow = document.createElement('tr');
                infoRow.innerHTML = `
                    <td colspan="6" class="px-4 py-2 text-center text-gray-500 italic">
                        Mostrant ${displayLimit} de ${filteredData.length} registres
                    </td>
                `;
                tableBody.appendChild(infoRow);
            }
        }

        function setupSearchFunction() {
            const searchInput = document.getElementById('search-input');
            if (!searchInput) {
                console.warn('Element d\'entrada de cerca no trobat');
                return;
            }

            searchInput.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('#data-table-body tr');

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
        }

        // Sample data based on new structure
        const sampleData = [{
            timestamp: "8/16/2025 19:21:04",
            age: 48,
            nationality: "Espanyola",
            education_level: "Màster",
            tech_experience_years: "Major a 7 anys",
            city: "Barcelona",
            employment_status: "Assalariada, Emprenedora",
            salary_range: ">50.000€",
            has_dependents: true,
            organization_type: "Organització sense ànim de lucre",
            organization_sector: "Tecnologia",
            community_participation_frequency: "Freqüentment (més de 12 vegades a l'any)",
            community_inclusion_impact: "Sí, en part",
            main_participation_form: "Totes les anteriors",
            community_name: "SheHub",
            community_structure: "Col·laborativa (decisions compartides, lideratge distribuït)",
            collaborative_structure_equity: "Sí, en part",
            event_frequency: "Més de 10 vegades a l'any",
            tech_leadership_roles: ["Project/Product Manager Tech", "Tech Lead / CTO / Directiva en tecnologia"],
            networking_expansion: "Sí, molt",
            job_opportunities_access: true,
            job_opportunity_type: "Ser Co Fundadora de SheHub, donar suport amb mentories, gestionar projectes",
            community_influence_staying: "No ho sé-No s'aplica",
            resides_in_barcelona: true,
            identifies_as_woman: true,
            works_in_tech_3_years: true,
            is_community_member: true,
            increased_women_in_teams: "Sí, molt",
            participated_company_initiatives: true,
            company_initiatives_help_inclusion: "Sí, en part",
            effective_equity_activities: ["Programes de mentoria", "Esdeveniments de networking", "Tallers de formació", "Promoció de polítiques inclusives"],
            barriers_helped_with: ["Xarxes professionals limitades"],
            future_inclusion_actions: "Mentoria i patrocini, Visibilitat de dones líders, Xarxes professionals de col·laboració, Networking en esdeveniments clau",
            ods_contribution: "En gran mesura"
        }];

        // Event listeners
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM carregat, inicialitzant dashboard...');
            loadData();
            setupSearchFunction();

            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            }

            document.addEventListener('click', function (event) {
                const mobileMenu = document.getElementById('mobile-menu');
                const mobileMenuBtn = document.getElementById('mobile-menu-btn');

                if (mobileMenu && mobileMenuBtn &&
                    !mobileMenu.contains(event.target) &&
                    !mobileMenuBtn.contains(event.target)) {
                    mobileMenu.style.display = 'none';
                }
            });
        });

        // Fallback to sample data
        window.addEventListener('load', function () {
            setTimeout(() => {
                if (!allData.length) {
                    console.log('Utilitzant dades de mostra per a la demostració');
                    allData = sampleData;
                    filteredData = [...allData];
                    hideLoading();
                    showApp();
                    generateStats();
                    generateAllCharts();
                    populateFilters();
                    generateDataTable();
                }
            }, 5000);
        });
    </script>
</body>

</html>